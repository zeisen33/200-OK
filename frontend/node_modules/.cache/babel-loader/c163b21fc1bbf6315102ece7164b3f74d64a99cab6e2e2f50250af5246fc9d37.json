{"ast":null,"code":"import csrfFetch from \"./csrf\";\nconst RECEIVE_USER = 'users/RECEIVE_USER';\nconst REMOVE_USER = 'users/REMOVE_USER';\n\n// Action Creators\nexport const receiveUser = user => {\n  // debugger\n  return {\n    type: RECEIVE_USER,\n    user: user\n  };\n};\nexport const removeUser = userId => {\n  return {\n    type: REMOVE_USER,\n    userId: userId\n  };\n};\n\n// Thunk Action\nexport const loginUser = user => async dispatch => {\n  const response = await csrfFetch('/api/session', {\n    method: 'POST',\n    body: JSON.stringify(user)\n  });\n  const res = await response.json();\n  storeCurrentUser(res.user);\n  dispatch(setCurrentUser(res.user));\n  return response;\n  // sessionStorage.setItem('currentUser', JSON.stringify(res.user))\n  // debugger\n  // dispatch(receiveUser(res.user))\n};\n\nconst initialState = {\n  user: JSON.parse(sessionStorage.getItem(\"currentUser\"))\n};\nconst storeCSRFToken = response => {\n  const csrfToken = response.headers.get(\"X-CSRF-Token\");\n  if (csrfToken) sessionStorage.setItem(\"X-CSRF-Token\", csrfToken);\n};\nconst storeCurrentUser = user => {\n  if (user) sessionStorage.setItem(\"currentUser\", JSON.stringify(user));else sessionStorage.removeItem(\"currentUser\");\n};\nexport const restoreSession = () => async dispatch => {\n  const response = await csrfFetch(\"/api/session\");\n  storeCSRFToken(response);\n  const data = await response.json();\n  storeCurrentUser(data.user);\n  dispatch(setCurrentUser(data.user));\n  return response;\n};\nexport const logoutUser = userId => async dispatch => {\n  const response = await csrfFetch('/api/session', {\n    method: 'DELETE'\n  });\n  sessionStorage.setItem('currentUser', null);\n  dispatch(removeUser(userId));\n};\n\n// Reducer\nconst sessionReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    user: null\n  };\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  // debugger\n  let newState = {\n    ...state\n  };\n  switch (action.type) {\n    case RECEIVE_USER:\n      newState.user = action.user;\n      return newState;\n    case REMOVE_USER:\n      newState.user = null;\n      return newState;\n    default:\n      return state;\n  }\n};\nexport default sessionReducer;","map":{"version":3,"names":["csrfFetch","RECEIVE_USER","REMOVE_USER","receiveUser","user","type","removeUser","userId","loginUser","dispatch","response","method","body","JSON","stringify","res","json","storeCurrentUser","setCurrentUser","initialState","parse","sessionStorage","getItem","storeCSRFToken","csrfToken","headers","get","setItem","removeItem","restoreSession","data","logoutUser","sessionReducer","state","action","newState"],"sources":["/Users/zane/Desktop/GitHub/FSP/frontend/src/store/session.js"],"sourcesContent":["import csrfFetch from \"./csrf\"\n\nconst RECEIVE_USER = 'users/RECEIVE_USER'\nconst REMOVE_USER = 'users/REMOVE_USER'\n\n// Action Creators\nexport const receiveUser = (user) => {\n    // debugger\n    return {\n        type: RECEIVE_USER,\n        user: user\n    }\n}\n\nexport const removeUser = (userId) => {\n    return {\n        type: REMOVE_USER,\n        userId: userId\n    }\n}\n\n// Thunk Action\nexport const loginUser = (user) => async (dispatch) => {\n    const response = await csrfFetch('/api/session', {\n        method: 'POST',\n        body: JSON.stringify(user)\n    })\n\n    const res = await response.json()\n    storeCurrentUser(res.user)\n    dispatch(setCurrentUser(res.user))\n    return response\n    // sessionStorage.setItem('currentUser', JSON.stringify(res.user))\n    // debugger\n    // dispatch(receiveUser(res.user))\n}\n\nconst initialState = {\n    user: JSON.parse(sessionStorage.getItem(\"currentUser\"))\n}\n\nconst storeCSRFToken = (response) => {\n    const csrfToken = response.headers.get(\"X-CSRF-Token\")\n    if (csrfToken) sessionStorage.setItem(\"X-CSRF-Token\", csrfToken)\n}\n\nconst storeCurrentUser = (user) => {\n    if (user) sessionStorage.setItem(\"currentUser\", JSON.stringify(user))\n    else sessionStorage.removeItem(\"currentUser\")\n}\n\nexport const restoreSession = () => async (dispatch) => {\n    const response = await csrfFetch(\"/api/session\")\n    storeCSRFToken(response)\n    const data = await response.json()\n    storeCurrentUser(data.user)\n    dispatch(setCurrentUser(data.user))\n    return response\n}\n\nexport const logoutUser = (userId) => async (dispatch) => {\n    const response = await csrfFetch('/api/session', {\n        method: 'DELETE'\n    })\n\n    sessionStorage.setItem('currentUser', null)\n    dispatch(removeUser(userId))\n}\n\n// Reducer\nconst sessionReducer = (state={ user: null }, action) => {\n    // debugger\n    let newState = { ...state }\n\n    switch (action.type) {\n        case RECEIVE_USER:\n            newState.user = action.user\n            return newState\n        case REMOVE_USER:\n            newState.user = null\n            return newState\n        default:\n            return state\n    }\n}\n\nexport default sessionReducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}