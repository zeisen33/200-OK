{"ast":null,"code":"import _objectSpread from\"/Users/zane/Desktop/GitHub/FSP/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/zane/Desktop/GitHub/FSP/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/zane/Desktop/GitHub/FSP/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import csrfFetch from\"./csrf\";var SET_CURRENT_USER='session/setCurrentUser';var REMOVE_CURRENT_USER='session/removeCurrentUser';var RECEIVE_USER='users/RECEIVE_USER';var REMOVE_USER='users/REMOVE_USER';// Action Creators\nexport var receiveUser=function receiveUser(user){// debugger\nreturn{type:RECEIVE_USER,user:user};};export var removeUser=function removeUser(userId){return{type:REMOVE_USER,userId:userId};};var setCurrentUser=function setCurrentUser(user){// debugger\nreturn{type:SET_CURRENT_USER,payload:user};};var removeCurrentUser=function removeCurrentUser(){return{type:REMOVE_CURRENT_USER};};// Thunk Action\nexport var loginUser=function loginUser(user){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var email,password,response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:// debugger\nemail=user.email,password=user.password;_context.next=3;return csrfFetch('/api/session',{method:'POST',body:JSON.stringify({email:email,password:password})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context.abrupt(\"return\",response);case 10:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var initialState={user:JSON.parse(sessionStorage.getItem('currentUser'))};var storeCSRFToken=function storeCSRFToken(response){var csrfToken=response.headers.get(\"X-CSRF-Token\");if(csrfToken)sessionStorage.setItem(\"X-CSRF-Token\",csrfToken);};var storeCurrentUser=function storeCurrentUser(user){// debugger\nif(user)sessionStorage.setItem(\"currentUser\",JSON.stringify(user));else sessionStorage.removeItem(\"currentUser\");};export var restoreSession=function restoreSession(){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return csrfFetch(\"/api/session\");case 2:response=_context2.sent;storeCSRFToken(response);_context2.next=6;return response.json();case 6:data=_context2.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context2.abrupt(\"return\",response);case 10:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logoutUser=function logoutUser(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return csrfFetch('/api/session',{method:'DELETE'});case 2:response=_context3.sent;// sessionStorage.setItem('currentUser', null)\nstoreCurrentUser(null);dispatch(removeCurrentUser(userId));case 5:case\"end\":return _context3.stop();}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var signup=function signup(user){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){var displayName,email,password,response,data;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:displayName=user.displayName,email=user.email,password=user.password;_context4.next=3;return csrfFetch(\"api/users\",{method:\"POST\",body:JSON.stringify({displayName:displayName,email:email,password:password})});case 3:response=_context4.sent;_context4.next=6;return response.json();case 6:data=_context4.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context4.abrupt(\"return\",response);case 10:case\"end\":return _context4.stop();}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};// Reducer\nvar sessionReducer=function sessionReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_CURRENT_USER:return _objectSpread(_objectSpread({},state),{},{user:action.payload});case REMOVE_CURRENT_USER:return _objectSpread(_objectSpread({},state),{},{user:null});default:return state;}};export default sessionReducer;","map":{"version":3,"names":["csrfFetch","SET_CURRENT_USER","REMOVE_CURRENT_USER","RECEIVE_USER","REMOVE_USER","receiveUser","user","type","removeUser","userId","setCurrentUser","payload","removeCurrentUser","loginUser","dispatch","email","password","method","body","JSON","stringify","response","json","data","storeCurrentUser","initialState","parse","sessionStorage","getItem","storeCSRFToken","csrfToken","headers","get","setItem","removeItem","restoreSession","logoutUser","signup","displayName","sessionReducer","state","action"],"sources":["/Users/zane/Desktop/GitHub/FSP/frontend/src/store/session.js"],"sourcesContent":["import csrfFetch from \"./csrf\"\n\nconst SET_CURRENT_USER = 'session/setCurrentUser'\nconst REMOVE_CURRENT_USER = 'session/removeCurrentUser'\nconst RECEIVE_USER = 'users/RECEIVE_USER'\nconst REMOVE_USER = 'users/REMOVE_USER'\n\n// Action Creators\nexport const receiveUser = (user) => {\n    // debugger\n    return {\n        type: RECEIVE_USER,\n        user: user\n    }\n}\n\nexport const removeUser = (userId) => {\n    return {\n        type: REMOVE_USER,\n        userId: userId\n    }\n}\n\nconst setCurrentUser = (user) => {\n  // debugger\n    return {\n      type: SET_CURRENT_USER,\n      payload: user\n    };\n  };\n  \n  const removeCurrentUser = () => {\n    return {\n      type: REMOVE_CURRENT_USER\n    };\n  };\n\n// Thunk Action\nexport const loginUser = (user) => async (dispatch) => {\n    // debugger\n    const { email, password } = user;\n    const response = await csrfFetch('/api/session', {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n    const data = await response.json();\n    storeCurrentUser(data.user);\n    dispatch(setCurrentUser(data.user));\n    return response;\n};\n\nconst initialState = { user: JSON.parse(sessionStorage.getItem('currentUser')) }\n\nconst storeCSRFToken = (response) => {\n    const csrfToken = response.headers.get(\"X-CSRF-Token\")\n    if (csrfToken) sessionStorage.setItem(\"X-CSRF-Token\", csrfToken)\n}\n\nconst storeCurrentUser = (user) => {\n  // debugger\n    if (user) sessionStorage.setItem(\"currentUser\", JSON.stringify(user))\n    else sessionStorage.removeItem(\"currentUser\")\n}\n\nexport const restoreSession = () => async (dispatch) => {\n    const response = await csrfFetch(\"/api/session\")\n    storeCSRFToken(response)\n    const data = await response.json()\n    storeCurrentUser(data.user)\n    dispatch(setCurrentUser(data.user))\n    return response\n}\n\nexport const logoutUser = (userId) => async (dispatch) => {\n    const response = await csrfFetch('/api/session', {\n        method: 'DELETE'\n    })\n\n    // sessionStorage.setItem('currentUser', null)\n    storeCurrentUser(null)\n    dispatch(removeCurrentUser(userId))\n}\n\nexport const signup = (user) => async (dispatch) => {\n  const { displayName, email, password } = user;\n  const response = await csrfFetch(\"api/users\", {\n    method: \"POST\",\n    body: JSON.stringify({\n      displayName,\n      email,\n      password\n    })\n  });\n  const data = await response.json();\n  storeCurrentUser(data.user);\n  dispatch(setCurrentUser(data.user));\n  return response;\n};\n\n// Reducer\nconst sessionReducer = (state = initialState, action) => {\n    switch (action.type) {\n      case SET_CURRENT_USER:\n        return { ...state, user: action.payload };\n      case REMOVE_CURRENT_USER:\n        return { ...state, user: null };\n      default:\n        return state;\n    }\n  };\n  \n  \nexport default sessionReducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}